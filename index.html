<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SALMAN Rewards Zone</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f6fa;}
header{background:#1e90ff;color:#fff;padding:15px;text-align:center;}
#coins{font-size:18px;margin-top:5px;}
.container{padding:15px;}
.search-box{display:flex;gap:10px;margin-bottom:10px;}
.search-box input{flex:1;padding:10px;font-size:16px;}
.search-box button{padding:10px 15px;font-size:16px;background:#1e90ff;color:#fff;border:none;cursor:pointer;}
.video-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px;}
.video-card{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);overflow:hidden;}
.video-card img{width:100%;}
.video-card .info{padding:10px;}
.video-card h4{margin:0;font-size:14px;}
.video-card p{margin:5px 0 0;font-size:12px;color:#555;}
.player{margin-top:20px;}
.reward{margin-top:10px;background:#eaf4ff;padding:10px;border-radius:6px;font-size:14px;}
#loginBtn,#logoutBtn{padding:10px 15px;margin:5px;border:none;cursor:pointer;border-radius:4px;}
#loginBtn{background:#34A853;color:#fff;}
#logoutBtn{background:#EA4335;color:#fff;}
</style>
</head>
<body>

<header>
  <h2>SALMAN Rewards Zone</h2>
  <div id="authButtons">
    <button id="loginBtn">Login with Google</button>
  </div>
  <div id="coins" style="display:none;">Coins: 0</div>
</header>

<div class="container">
  <div class="search-box">
    <input type="text" id="query" placeholder="Search videos..." disabled>
    <button onclick="searchVideos()" id="searchBtn" disabled>Search</button>
  </div>
  <div id="videoList" class="video-list"></div>
  <div id="playerSection" class="player"></div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDhagZJsz-W59Nl1gyAnhIEcCNd1-IpYa0",
  authDomain: "mr-earning-dabd7.firebaseapp.com",
  databaseURL: "https://mr-earning-dabd7-default-rtdb.firebaseio.com",
  projectId: "mr-earning-dabd7",
  storageBucket: "mr-earning-dabd7.firebasestorage.app",
  messagingSenderId: "1011066300124",
  appId: "1:1011066300124:web:de70df6effe369257cb619",
  measurementId: "G-9Z9VFWXVRD"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// YouTube API
const YT_API = "AIzaSyAm4TYU1VY17xTFiNbDuIg29v_X-r0mEOQ"; // <-- Replace with your API Key

let currentUser = null;
let coins = 0;
let rewardedVideos = {};

// --- Auth ---
const loginBtn = document.getElementById("loginBtn");
const authButtons = document.getElementById("authButtons");
const searchInput = document.getElementById("query");
const searchBtn = document.getElementById("searchBtn");

loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user;
    authButtons.innerHTML = `<button id="logoutBtn">Logout</button>`;
    document.getElementById("logoutBtn").onclick = ()=>auth.signOut();
    document.getElementById("coins").style.display = "block";
    searchInput.disabled = false;
    searchBtn.disabled = false;

    // Load coins from Firestore
    db.collection("users").doc(user.uid).get().then(doc=>{
      if(doc.exists){
        coins = doc.data().coins || 0;
        updateCoins();
      }else{
        db.collection("users").doc(user.uid).set({
          name: user.displayName,
          email: user.email,
          coins: 0,
          joinedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        coins = 0;
        updateCoins();
      }
    });
  }else{
    currentUser = null;
    authButtons.innerHTML = `<button id="loginBtn">Login with Google</button>`;
    document.getElementById("coins").style.display = "none";
    searchInput.disabled = true;
    searchBtn.disabled = true;
  }
});

// --- Update coins
function updateCoins(){
  document.getElementById("coins").innerText = "Coins: " + coins;
  if(currentUser){
    db.collection("users").doc(currentUser.uid).update({coins: coins});
  }
}

// --- Search YouTube
function searchVideos(){
  const q = searchInput.value;
  if(!q) return;
  fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=6&q=${q}&key=${YT_API}`)
  .then(res=>res.json())
  .then(data=>{
    const list = document.getElementById("videoList");
    list.innerHTML="";
    data.items.forEach(v=>{
      const card = document.createElement("div");
      card.className="video-card";
      card.innerHTML=`
        <img src="${v.snippet.thumbnails.medium.url}">
        <div class="info">
          <h4>${v.snippet.title}</h4>
          <p>${v.snippet.channelTitle}</p>
          <button onclick="playVideo('${v.id.videoId}')">Watch</button>
        </div>`;
      list.appendChild(card);
    });
  });
}

// --- Play Video
function playVideo(videoId){
  const section = document.getElementById("playerSection");
  section.innerHTML = `
    <iframe width="100%" height="220"
      src="https://www.youtube.com/embed/${videoId}?enablejsapi=1"
      frameborder="0" allowfullscreen></iframe>
    <div class="reward">
      Watch 30 seconds to earn <b>5 coins</b>
    </div>
  `;
  if(rewardedVideos[videoId]) return;
  setTimeout(()=>{
    coins+=5;
    rewardedVideos[videoId]=true;
    updateCoins();
    alert("ðŸŽ‰ You earned 5 coins!");
  },30000);
}

</script>
</body>
</html>